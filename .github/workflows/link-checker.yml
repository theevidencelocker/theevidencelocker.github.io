name: Check Links in Data.json

on:
  # Runs on every push to the main branch
  push:
    branches: [ "main" ]
  # Runs on every pull request targeting main
  pull_request:
    branches: [ "main" ]
  # Runs daily at midnight UTC to catch links that rot over time
  schedule:
    - cron: "0 0 * * *"
  # Allows you to run this manually from the Actions tab for testing
  workflow_dispatch:

jobs:
  link-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Lychee Link Checker
        uses: lycheeverse/lychee-action@v1.10.0
        with:
          # --max-concurrency 1: Only check one link at a time (throttles the speed)
          # --max-retries 3: If it fails, try 3 more times
          # --retry-wait-time 10: Wait 10 seconds between retries
          args: --verbose --no-progress --max-concurrency 1 --max-retries 3 --retry-wait-time 10 './data.json' --exclude 'https://thebinaryhick.blog'
          fail: true
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
